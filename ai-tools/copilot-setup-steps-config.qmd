
The `.github/workflows/copilot-setup-steps.yml` file
allows you to customize the development environment
in which the GitHub Copilot coding agent operates.
This file preinstalls tools and dependencies
so that Copilot can build, test, and lint your code more reliably.

#### Why Configure the Environment?

While Copilot can discover and install dependencies through trial and error,
this can be slow and unreliable.
Additionally, Copilot may be unable to access private dependencies.
Preconfiguring the environment ensures:

- Faster agent startup and execution
- More reliable builds and tests
- Access to private or authenticated dependencies
- Consistent development environment across all agent sessions

#### File Location and Structure

The workflow file must be located at
`.github/workflows/copilot-setup-steps.yml`
in your repository's **default branch**.
It follows GitHub Actions workflow syntax
but must contain a single job named `copilot-setup-steps`.

#### Basic Configuration Example

See [Appendix: Copilot Setup Steps File](#sec-appendix-copilot-setup-steps) for the configuration used in this repository
(adapted for R and Quarto projects).

#### Using `actions/checkout`

The [`actions/checkout`](https://github.com/actions/checkout) action
is used to check out your repository code
so that the workflow can access it.
While Copilot will automatically check out your repository if you don't include this step,
**explicitly including it is necessary** when your setup steps need to access repository files.

**Why explicitly include checkout?**

Many dependency installation steps require access to repository files:

- `r-lib/actions/setup-renv@v2` needs `renv.lock` to install R package dependencies
- `r-lib/actions/setup-r-dependencies@v2` needs `DESCRIPTION` to install R package dependencies
- `npm ci` needs `package-lock.json` to install Node.js dependencies
- `pip install -r requirements.txt` needs the requirements file

Without an explicit checkout step,
these dependency installation commands will fail
because the necessary files won't be available yet.

**Basic checkout:**

```yaml
- name: Checkout code
  uses: actions/checkout@v4
```

**Important:** The Copilot coding agent overrides any `fetch-depth` value
you set in the checkout step.
According to [GitHub's official documentation](https://docs.github.com/en/copilot/how-tos/use-copilot-agents/coding-agent/customize-the-agent-environment),
this override happens "to allow the agent to rollback commits upon request,
while mitigating security risks."
The agent dynamically determines the appropriate fetch depth
based on the pull request context.

While you cannot control the fetch depth used by Copilot,
the agent still has access to sufficient git history
to perform its work effectively,
including comparing changes and understanding the context of your pull request.

#### Configurable Options

You can customize only these specific settings
in the `copilot-setup-steps` job:

- `steps`: Setup commands and actions to run
- `permissions`: Access permissions (typically `contents: read`)
- `runs-on`: Runner type (Ubuntu x64 Linux only)
- `services`: Database or service containers
- `snapshot`: Save environment state
- `timeout-minutes`: Maximum 59 minutes

All other workflow settings are ignored by Copilot.

#### Common Setup Tasks

**For Node.js/TypeScript projects:**

```yaml
- name: Set up Node.js
  uses: actions/setup-node@v4
  with:
    node-version: "20"
    cache: "npm"

- name: Install dependencies
  run: npm ci
```

**For Python projects:**

```yaml
- name: Set up Python
  uses: actions/setup-python@v5
  with:
    python-version: "3.11"

- name: Install dependencies
  run: pip install -r requirements.txt
```

**For R projects:**

```yaml
- name: Set up R
  uses: r-lib/actions/setup-r@v2
  with:
    r-version: 'release'

- name: Install R dependencies
  uses: r-lib/actions/setup-renv@v2
```

#### Environment Variables and Secrets

To set environment variables for Copilot:

1. Navigate to your repository's **Settings**
2. Go to **Environments**
3. Select or create the `copilot` environment
4. Add environment variables or secrets as needed

Use secrets for sensitive values like API keys or passwords.

#### Testing Your Configuration

The workflow runs automatically when you modify
`copilot-setup-steps.yml`,
allowing you to validate changes in pull requests.
You can also manually trigger the workflow
from the repository's **Actions** tab.

Setup logs appear in the agent session logs
when Copilot starts working.
If a step fails,
Copilot will skip remaining steps
and begin working with the current environment state.

#### Advanced Configuration

**Larger runners:**
For projects requiring more resources,
you can use larger GitHub-hosted runners:

```yaml
jobs:
  copilot-setup-steps:
    runs-on: ubuntu-4-core
```

**Self-hosted runners (ARC):**
For access to internal resources or private registries,
use Actions Runner Controller (ARC) self-hosted runners:

```yaml
jobs:
  copilot-setup-steps:
    runs-on: arc-scale-set-name
```

Note: When using self-hosted runners,
you must disable Copilot's integrated firewall
in repository settings and configure
appropriate network security controls.

**Git Large File Storage (LFS):**
If your repository uses Git LFS:

```yaml
- uses: actions/checkout@v4
  with:
    lfs: true
```

#### Further Reading

For complete details,
see [Customizing the development environment for GitHub Copilot coding agent](https://docs.github.com/en/copilot/how-tos/use-copilot-agents/coding-agent/customize-the-agent-environment).
