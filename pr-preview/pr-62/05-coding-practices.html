<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; R Coding Practices â€“ UCD-SeRG Lab Manual</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06-coding-style.html" rel="next">
<link href="./04-code-repositories.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-0dd2bd5de344125cf763a379ddc3eb04.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-7e34ecb6a0e7991f0346b0751d4a7c3f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-0dd2bd5de344125cf763a379ddc3eb04.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-coding-practices.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R Coding Practices</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">UCD-SeRG Lab Manual</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/UCD-SERG/lab-manual" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./UCD-SeRG-Lab-Manual.pdf">
              <i class="bi bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./UCD-SeRG-Lab-Manual.epub">
              <i class="bi bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./UCD-SeRG-Lab-Manual.docx">
              <i class="bi bi-file-word pe-1"></i>
            Download Docx
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Welcome to UCD-SeRG!</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-culture-and-conduct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Culture and conduct</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-communication.html" class="sidebar-item-text sidebar-link" preview-toc-changed>
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Communication and coordination</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-reproducibility.html" class="sidebar-item-text sidebar-link" preview-toc-changed>
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reproducibility</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-code-repositories.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Code repositories</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-coding-practices.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R Coding Practices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-coding-style.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">R Code Style</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-big-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Big data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-data-masking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data masking</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Github</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-unix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Unix</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-reproducible-environments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Reproducible Environments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-code-publication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Code Publication</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-data-publication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Data Publication</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-slurm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">High-performance computing (HPC)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-ai-tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Use of AI</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-checklists.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Checklists</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Resources</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#lab-protocols-for-code-and-data" id="toc-lab-protocols-for-code-and-data" class="nav-link active" data-scroll-target="#lab-protocols-for-code-and-data"><span class="header-section-number">6.1</span> Lab Protocols for Code and Data</a></li>
  <li><a href="#sec-r-package-tools" id="toc-sec-r-package-tools" class="nav-link" data-scroll-target="#sec-r-package-tools"><span class="header-section-number">6.2</span> Essential R Package Development Tools</a>
  <ul class="collapse">
  <li><a href="#usethis-package-setup-and-management" id="toc-usethis-package-setup-and-management" class="nav-link" data-scroll-target="#usethis-package-setup-and-management"><span class="header-section-number">6.2.1</span> usethis: Package Setup and Management</a></li>
  <li><a href="#devtools-development-workflow" id="toc-devtools-development-workflow" class="nav-link" data-scroll-target="#devtools-development-workflow"><span class="header-section-number">6.2.2</span> devtools: Development Workflow</a></li>
  <li><a href="#pkgdown-package-websites" id="toc-pkgdown-package-websites" class="nav-link" data-scroll-target="#pkgdown-package-websites"><span class="header-section-number">6.2.3</span> pkgdown: Package Websites</a></li>
  </ul></li>
  <li><a href="#sec-r-workflow" id="toc-sec-r-workflow" class="nav-link" data-scroll-target="#sec-r-workflow"><span class="header-section-number">6.3</span> Complete Package Development Workflow</a>
  <ul class="collapse">
  <li><a href="#initial-setup" id="toc-initial-setup" class="nav-link" data-scroll-target="#initial-setup"><span class="header-section-number">6.3.1</span> 1. Initial Setup</a></li>
  <li><a href="#add-dependencies" id="toc-add-dependencies" class="nav-link" data-scroll-target="#add-dependencies"><span class="header-section-number">6.3.2</span> 2. Add Dependencies</a></li>
  <li><a href="#write-functions" id="toc-write-functions" class="nav-link" data-scroll-target="#write-functions"><span class="header-section-number">6.3.3</span> 3. Write Functions</a></li>
  <li><a href="#document" id="toc-document" class="nav-link" data-scroll-target="#document"><span class="header-section-number">6.3.4</span> 4. Document</a></li>
  <li><a href="#test" id="toc-test" class="nav-link" data-scroll-target="#test"><span class="header-section-number">6.3.5</span> 5. Test</a></li>
  <li><a href="#check" id="toc-check" class="nav-link" data-scroll-target="#check"><span class="header-section-number">6.3.6</span> 6. Check</a></li>
  <li><a href="#build-documentation-site" id="toc-build-documentation-site" class="nav-link" data-scroll-target="#build-documentation-site"><span class="header-section-number">6.3.7</span> 7. Build Documentation Site</a></li>
  <li><a href="#share-and-publish" id="toc-share-and-publish" class="nav-link" data-scroll-target="#share-and-publish"><span class="header-section-number">6.3.8</span> 8. Share and Publish</a></li>
  <li><a href="#when-to-use-explicit-value-tests" id="toc-when-to-use-explicit-value-tests" class="nav-link" data-scroll-target="#when-to-use-explicit-value-tests"><span class="header-section-number">6.3.9</span> When to Use Explicit Value Tests</a></li>
  <li><a href="#testing-best-practices" id="toc-testing-best-practices" class="nav-link" data-scroll-target="#testing-best-practices"><span class="header-section-number">6.3.10</span> Testing Best Practices</a></li>
  </ul></li>
  <li><a href="#sec-iteration" id="toc-sec-iteration" class="nav-link" data-scroll-target="#sec-iteration"><span class="header-section-number">6.4</span> Iterative Operations</a>
  <ul class="collapse">
  <li><a href="#lapply-and-sapply" id="toc-lapply-and-sapply" class="nav-link" data-scroll-target="#lapply-and-sapply"><span class="header-section-number">6.4.1</span> <code>lapply()</code> and <code>sapply()</code></a></li>
  <li><a href="#purrrmap-family" id="toc-purrrmap-family" class="nav-link" data-scroll-target="#purrrmap-family"><span class="header-section-number">6.4.2</span> <code>purrr::map()</code> Family</a></li>
  <li><a href="#purrrpmap-for-multiple-arguments" id="toc-purrrpmap-for-multiple-arguments" class="nav-link" data-scroll-target="#purrrpmap-for-multiple-arguments"><span class="header-section-number">6.4.3</span> <code>purrr::pmap()</code> for Multiple Arguments</a></li>
  <li><a href="#parallel-processing" id="toc-parallel-processing" class="nav-link" data-scroll-target="#parallel-processing"><span class="header-section-number">6.4.4</span> Parallel Processing</a></li>
  </ul></li>
  <li><a href="#sec-data-io" id="toc-sec-data-io" class="nav-link" data-scroll-target="#sec-data-io"><span class="header-section-number">6.5</span> Reading and Saving Data</a>
  <ul class="collapse">
  <li><a href="#rds-files-preferred" id="toc-rds-files-preferred" class="nav-link" data-scroll-target="#rds-files-preferred"><span class="header-section-number">6.5.1</span> RDS Files (Preferred)</a></li>
  <li><a href="#csv-files" id="toc-csv-files" class="nav-link" data-scroll-target="#csv-files"><span class="header-section-number">6.5.2</span> CSV Files</a></li>
  </ul></li>
  <li><a href="#sec-r-version-control" id="toc-sec-r-version-control" class="nav-link" data-scroll-target="#sec-r-version-control"><span class="header-section-number">6.6</span> Version Control and Collaboration</a>
  <ul class="collapse">
  <li><a href="#version-numbers" id="toc-version-numbers" class="nav-link" data-scroll-target="#version-numbers"><span class="header-section-number">6.6.1</span> Version Numbers</a></li>
  <li><a href="#news-file" id="toc-news-file" class="nav-link" data-scroll-target="#news-file"><span class="header-section-number">6.6.2</span> NEWS File</a></li>
  </ul></li>
  <li><a href="#sec-r-qa-checklist" id="toc-sec-r-qa-checklist" class="nav-link" data-scroll-target="#sec-r-qa-checklist"><span class="header-section-number">6.7</span> Quality Assurance Checklist</a></li>
  <li><a href="#sec-auto-styling" id="toc-sec-auto-styling" class="nav-link" data-scroll-target="#sec-auto-styling"><span class="header-section-number">6.8</span> Automated Code Styling</a>
  <ul class="collapse">
  <li><a href="#rstudio-built-in-formatting" id="toc-rstudio-built-in-formatting" class="nav-link" data-scroll-target="#rstudio-built-in-formatting"><span class="header-section-number">6.8.1</span> RStudio Built-in Formatting</a></li>
  <li><a href="#styler-package" id="toc-styler-package" class="nav-link" data-scroll-target="#styler-package"><span class="header-section-number">6.8.2</span> styler Package</a></li>
  <li><a href="#lintr-package" id="toc-lintr-package" class="nav-link" data-scroll-target="#lintr-package"><span class="header-section-number">6.8.3</span> lintr Package</a></li>
  </ul></li>
  <li><a href="#sec-documenting-code" id="toc-sec-documenting-code" class="nav-link" data-scroll-target="#sec-documenting-code"><span class="header-section-number">6.9</span> Documenting your code</a>
  <ul class="collapse">
  <li><a href="#function-headers" id="toc-function-headers" class="nav-link" data-scroll-target="#function-headers"><span class="header-section-number">6.9.1</span> Function headers</a></li>
  <li><a href="#script-headers" id="toc-script-headers" class="nav-link" data-scroll-target="#script-headers"><span class="header-section-number">6.9.2</span> Script headers</a></li>
  <li><a href="#sections-and-subsections" id="toc-sections-and-subsections" class="nav-link" data-scroll-target="#sections-and-subsections"><span class="header-section-number">6.9.3</span> Sections and subsections</a></li>
  <li><a href="#code-folding" id="toc-code-folding" class="nav-link" data-scroll-target="#code-folding"><span class="header-section-number">6.9.4</span> Code folding</a></li>
  <li><a href="#comments-in-the-body-of-your-code" id="toc-comments-in-the-body-of-your-code" class="nav-link" data-scroll-target="#comments-in-the-body-of-your-code"><span class="header-section-number">6.9.5</span> Comments in the body of your code</a></li>
  </ul></li>
  <li><a href="#object-naming" id="toc-object-naming" class="nav-link" data-scroll-target="#object-naming"><span class="header-section-number">6.10</span> Object naming</a></li>
  <li><a href="#function-calls" id="toc-function-calls" class="nav-link" data-scroll-target="#function-calls"><span class="header-section-number">6.11</span> Function calls</a></li>
  <li><a href="#sec-here-package-practices" id="toc-sec-here-package-practices" class="nav-link" data-scroll-target="#sec-here-package-practices"><span class="header-section-number">6.12</span> The here package</a></li>
  <li><a href="#readingsaving-data" id="toc-readingsaving-data" class="nav-link" data-scroll-target="#readingsaving-data"><span class="header-section-number">6.13</span> Reading/Saving Data</a>
  <ul class="collapse">
  <li><a href="#rds-vs-.rdata-files" id="toc-rds-vs-.rdata-files" class="nav-link" data-scroll-target="#rds-vs-.rdata-files"><span class="header-section-number">6.13.1</span> <code>.RDS</code> vs <code>.RData</code> Files</a></li>
  <li><a href="#csvs" id="toc-csvs" class="nav-link" data-scroll-target="#csvs"><span class="header-section-number">6.13.2</span> CSVs</a></li>
  </ul></li>
  <li><a href="#integrating-box-and-dropbox" id="toc-integrating-box-and-dropbox" class="nav-link" data-scroll-target="#integrating-box-and-dropbox"><span class="header-section-number">6.14</span> Integrating Box and Dropbox</a>
  <ul class="collapse">
  <li><a href="#box" id="toc-box" class="nav-link" data-scroll-target="#box"><span class="header-section-number">6.14.1</span> Box</a></li>
  <li><a href="#dropbox" id="toc-dropbox" class="nav-link" data-scroll-target="#dropbox"><span class="header-section-number">6.14.2</span> Dropbox</a></li>
  </ul></li>
  <li><a href="#sec-tidyverse" id="toc-sec-tidyverse" class="nav-link" data-scroll-target="#sec-tidyverse"><span class="header-section-number">6.15</span> Tidyverse</a></li>
  <li><a href="#coding-with-r-and-python" id="toc-coding-with-r-and-python" class="nav-link" data-scroll-target="#coding-with-r-and-python"><span class="header-section-number">6.16</span> Coding with R and Python</a></li>
  <li><a href="#repeating-analyses-with-different-variations" id="toc-repeating-analyses-with-different-variations" class="nav-link" data-scroll-target="#repeating-analyses-with-different-variations"><span class="header-section-number">6.17</span> Repeating analyses with different variations</a>
  <ul class="collapse">
  <li><a href="#lapply-and-sapply-1" id="toc-lapply-and-sapply-1" class="nav-link" data-scroll-target="#lapply-and-sapply-1"><span class="header-section-number">6.17.1</span> <code>lapply()</code> and <code>sapply()</code></a></li>
  <li><a href="#mapply-and-pmap" id="toc-mapply-and-pmap" class="nav-link" data-scroll-target="#mapply-and-pmap"><span class="header-section-number">6.17.2</span> <code>mapply()</code> and <code>pmap()</code></a></li>
  <li><a href="#parallel-processing-with-parallel-and-future-packages" id="toc-parallel-processing-with-parallel-and-future-packages" class="nav-link" data-scroll-target="#parallel-processing-with-parallel-and-future-packages"><span class="header-section-number">6.17.3</span> Parallel processing with <code>parallel</code> and <code>future</code> packages</a></li>
  </ul></li>
  <li><a href="#reviewing-code" id="toc-reviewing-code" class="nav-link" data-scroll-target="#reviewing-code"><span class="header-section-number">6.18</span> Reviewing Code</a></li>
  <li><a href="#constructing-pull-requests" id="toc-constructing-pull-requests" class="nav-link" data-scroll-target="#constructing-pull-requests"><span class="header-section-number">6.19</span> Constructing Pull Requests</a>
  <ul class="collapse">
  <li><a href="#write-focused-prs" id="toc-write-focused-prs" class="nav-link" data-scroll-target="#write-focused-prs"><span class="header-section-number">6.19.1</span> Write Focused PRs</a></li>
  <li><a href="#writing-pr-descriptions" id="toc-writing-pr-descriptions" class="nav-link" data-scroll-target="#writing-pr-descriptions"><span class="header-section-number">6.19.2</span> Writing PR Descriptions</a></li>
  <li><a href="#add-tests" id="toc-add-tests" class="nav-link" data-scroll-target="#add-tests"><span class="header-section-number">6.19.3</span> Add Tests</a></li>
  <li><a href="#separate-out-refactorings" id="toc-separate-out-refactorings" class="nav-link" data-scroll-target="#separate-out-refactorings"><span class="header-section-number">6.19.4</span> Separate Out Refactorings</a></li>
  </ul></li>
  <li><a href="#reviewing-pull-requests" id="toc-reviewing-pull-requests" class="nav-link" data-scroll-target="#reviewing-pull-requests"><span class="header-section-number">6.20</span> Reviewing Pull Requests</a>
  <ul class="collapse">
  <li><a href="#purpose-of-code-review" id="toc-purpose-of-code-review" class="nav-link" data-scroll-target="#purpose-of-code-review"><span class="header-section-number">6.20.1</span> Purpose of Code Review</a></li>
  <li><a href="#writing-review-comments" id="toc-writing-review-comments" class="nav-link" data-scroll-target="#writing-review-comments"><span class="header-section-number">6.20.2</span> Writing Review Comments</a></li>
  <li><a href="#mentoring-through-review" id="toc-mentoring-through-review" class="nav-link" data-scroll-target="#mentoring-through-review"><span class="header-section-number">6.20.3</span> Mentoring Through Review</a></li>
  <li><a href="#giving-constructive-feedback" id="toc-giving-constructive-feedback" class="nav-link" data-scroll-target="#giving-constructive-feedback"><span class="header-section-number">6.20.4</span> Giving Constructive Feedback</a></li>
  </ul></li>
  <li><a href="#creating-a-pull-request-template" id="toc-creating-a-pull-request-template" class="nav-link" data-scroll-target="#creating-a-pull-request-template"><span class="header-section-number">6.21</span> Creating a Pull Request Template</a></li>
  <li><a href="#sec-r-resources" id="toc-sec-r-resources" class="nav-link" data-scroll-target="#sec-r-resources"><span class="header-section-number">6.22</span> Additional Resources</a>
  <ul class="collapse">
  <li><a href="#r-package-development" id="toc-r-package-development" class="nav-link" data-scroll-target="#r-package-development"><span class="header-section-number">6.22.1</span> R Package Development</a></li>
  <li><a href="#general-r-programming" id="toc-general-r-programming" class="nav-link" data-scroll-target="#general-r-programming"><span class="header-section-number">6.22.2</span> General R Programming</a></li>
  <li><a href="#shiny-development" id="toc-shiny-development" class="nav-link" data-scroll-target="#shiny-development"><span class="header-section-number">6.22.3</span> Shiny Development</a></li>
  <li><a href="#git-and-version-control" id="toc-git-and-version-control" class="nav-link" data-scroll-target="#git-and-version-control"><span class="header-section-number">6.22.4</span> Git and Version Control</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/UCD-SERG/lab-manual/edit/main/05-coding-practices.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/UCD-SERG/lab-manual/blob/main/05-coding-practices.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/UCD-SERG/lab-manual/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<div class="preview-home-changes-banner">
    <p style="margin: 0;">
        <strong>ðŸ“‹ Changes in this PR:</strong> The following chapters have been modified: <a href="02-communication.html">3. &nbsp; <span class="chapter-title">Communication and coordination</span></a>, <a href="03-reproducibility.html">4. &nbsp; <span class="chapter-title">Reproducibility</span></a>
        <br>
        <strong>ðŸ“„ DOCX with tracked changes:</strong> <a href="UCD-SeRG-Lab-Manual-tracked-changes.docx" download>Download UCD-SeRG-Lab-Manual-tracked-changes.docx</a>
        <br>
        <strong>ðŸ’¡ Tip:</strong> If change highlighting is glitchy, add the <code>no-preview-highlights</code> label to this PR to disable it.
    </p>
</div>



<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-r-coding-practices" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R Coding Practices</span></span></h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<p>Adapted by UCD-SeRG team from <a href="https://jadebc.github.io/lab-manual/coding-practices.html">original by Kunal Mishra, Jade Benjamin-Chung, Stephanie Djajadi, and Iris Tong</a></p>
<section id="lab-protocols-for-code-and-data" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="lab-protocols-for-code-and-data"><span class="header-section-number">6.1</span> Lab Protocols for Code and Data</h2>
<p>Just as wet labs have strict safety protocols to ensure reproducible results and prevent contamination, our computational lab has protocols for coding and data management. These protocols are not suggestionsâ€”they are essential practices that:</p>
<ul>
<li><strong>Ensure reproducibility</strong>: Others (including your future self) can recreate your analysis</li>
<li><strong>Prevent errors</strong>: Systematic approaches reduce the risk of mistakes</li>
<li><strong>Enable collaboration</strong>: Consistent practices allow team members to work together efficiently</li>
<li><strong>Maintain data integrity</strong>: Proper handling prevents data corruption and loss</li>
<li><strong>Support publication</strong>: Well-documented, reproducible code is increasingly required for publication</li>
</ul>
<p><strong>Violating these protocols can have serious consequences</strong>, including invalid results, wasted time, inability to publish, and damage to scientific credibility. Treat coding and data management protocols with the same seriousness as you would safety protocols in a wet lab.</p>
</section>
<section id="sec-r-package-tools" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="sec-r-package-tools"><span class="header-section-number">6.2</span> Essential R Package Development Tools</h2>
<p>The following tools are essential for R package development in our lab:</p>
<section id="usethis-package-setup-and-management" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="usethis-package-setup-and-management"><span class="header-section-number">6.2.1</span> usethis: Package Setup and Management</h3>
<p><code>usethis</code> automates common package development tasks:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install usethis</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"usethis"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new package</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">create_package</span>(<span class="st">"~/myproject"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add common components</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_mit_license</span>()          <span class="co"># Add a license</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_git</span>()                  <span class="co"># Initialize git</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_github</span>()               <span class="co"># Connect to GitHub</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_testthat</span>()             <span class="co"># Set up testing infrastructure</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_vignette</span>(<span class="st">"intro"</span>)      <span class="co"># Create a vignette (shipped with package)</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_article</span>(<span class="st">"case-study"</span>)  <span class="co"># Create an article (website-only)</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_data_raw</span>(<span class="st">"dataset"</span>)    <span class="co"># Create data processing script</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">"dplyr"</span>)       <span class="co"># Add a dependency</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_pipe</span>()                 <span class="co"># Import magrittr pipe operator (no longer recommended)</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Increment version</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_version</span>()              <span class="co"># Increment package version</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="devtools-development-workflow" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="devtools-development-workflow"><span class="header-section-number">6.2.2</span> devtools: Development Workflow</h3>
<p><code>devtools</code> provides the core development workflow:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install devtools</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load your package for interactive development</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>()                <span class="co"># Like library(), but for development</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Documentation</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">document</span>()                <span class="co"># Generate documentation from roxygen2</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">test</span>()                    <span class="co"># Run all tests</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">test_active_file</span>()        <span class="co"># Run tests in current file</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">check</span>()                   <span class="co"># R CMD check (comprehensive validation)</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">check_man</span>()               <span class="co"># Check documentation only</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Dependencies</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_dev_deps</span>()        <span class="co"># Install all development dependencies</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Building</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">build</span>()                   <span class="co"># Build package bundle</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install</span>()                 <span class="co"># Install package locally</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="pkgdown-package-websites" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="pkgdown-package-websites"><span class="header-section-number">6.2.3</span> pkgdown: Package Websites</h3>
<p><code>pkgdown</code> builds beautiful documentation websites from your package:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install pkgdown</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"pkgdown"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up pkgdown</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_pkgdown</span>()</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Build website locally</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>pkgdown<span class="sc">::</span><span class="fu">build_site</span>()</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview in browser</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>pkgdown<span class="sc">::</span><span class="fu">build_site</span>(<span class="at">preview =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Build components separately</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>pkgdown<span class="sc">::</span><span class="fu">build_reference</span>()          <span class="co"># Function reference</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>pkgdown<span class="sc">::</span><span class="fu">build_articles</span>()           <span class="co"># Vignettes</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>pkgdown<span class="sc">::</span><span class="fu">build_home</span>()               <span class="co"># Home page from README</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Configure your pkgdown site</strong> with <code>_pkgdown.yml</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">url</span><span class="kw">:</span><span class="at"> https://ucd-serg.github.io/myproject</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bootstrap</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">reference</span><span class="kw">:</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Data Preparation"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">desc</span><span class="kw">:</span><span class="at"> </span><span class="st">"Functions for preparing and cleaning data"</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">contents</span><span class="kw">:</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> prep_study_data</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> validate_data</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Analysis"</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">desc</span><span class="kw">:</span><span class="at"> </span><span class="st">"Core analysis functions"</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">contents</span><span class="kw">:</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> run_primary_analysis</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> sensitivity_analysis</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="fu">articles</span><span class="kw">:</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Analysis Workflow"</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">navbar</span><span class="kw">:</span><span class="at"> Analysis</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">contents</span><span class="kw">:</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> 01-data-preparation</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> 02-primary-analysis</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> 03-sensitivity-analysis</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="sec-r-workflow" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="sec-r-workflow"><span class="header-section-number">6.3</span> Complete Package Development Workflow</h2>
<p>Hereâ€™s the typical workflow for developing an R package in our lab:</p>
<section id="initial-setup" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="initial-setup"><span class="header-section-number">6.3.1</span> 1. Initial Setup</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create package structure</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">create_package</span>(<span class="st">"~/myproject"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up infrastructure</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_git</span>()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_github</span>()</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_testthat</span>()</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_pkgdown</span>()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_mit_license</span>()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_readme_rmd</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="add-dependencies" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2" class="anchored" data-anchor-id="add-dependencies"><span class="header-section-number">6.3.2</span> 2. Add Dependencies</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add packages your project depends on</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">"readr"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add packages only needed for development/testing</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">"testthat"</span>, <span class="at">type =</span> <span class="st">"Suggests"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="write-functions" class="level3" data-number="6.3.3">
<h3 data-number="6.3.3" class="anchored" data-anchor-id="write-functions"><span class="header-section-number">6.3.3</span> 3. Write Functions</h3>
<p>Create functions in <code>R/</code> directory with roxygen2 documentation:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Prepare Study Data</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' Clean and prepare raw study data for analysis.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param raw_data A data frame containing raw study data</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param validate Logical; whether to run validation checks</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returns A cleaned data frame ready for analysis</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' raw_data &lt;- read_csv("data.csv")</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' clean_data &lt;- prep_study_data(raw_data)</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>prep_study_data <span class="ot">&lt;-</span> <span class="cf">function</span>(raw_data, <span class="at">validate =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Function implementation</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="document" class="level3" data-number="6.3.4">
<h3 data-number="6.3.4" class="anchored" data-anchor-id="document"><span class="header-section-number">6.3.4</span> 4. Document</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate documentation from roxygen2 comments</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">document</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="test" class="level3" data-number="6.3.5">
<h3 data-number="6.3.5" class="anchored" data-anchor-id="test"><span class="header-section-number">6.3.5</span> 5. Test</h3>
<p>Create tests in <code>tests/testthat/</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tests/testthat/test-data_prep.R</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"prep_study_data handles missing values"</span>, {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  raw_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="dv">3</span>))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">prep_study_data</span>(raw_data)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_false</span>(<span class="fu">anyNA</span>(result<span class="sc">$</span>x))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run tests:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">test</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="check" class="level3" data-number="6.3.6">
<h3 data-number="6.3.6" class="anchored" data-anchor-id="check"><span class="header-section-number">6.3.6</span> 6. Check</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comprehensive package check</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">check</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Fix any warnings or errors before proceeding.</p>
</section>
<section id="build-documentation-site" class="level3" data-number="6.3.7">
<h3 data-number="6.3.7" class="anchored" data-anchor-id="build-documentation-site"><span class="header-section-number">6.3.7</span> 7. Build Documentation Site</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pkgdown<span class="sc">::</span><span class="fu">build_site</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="share-and-publish" class="level3" data-number="6.3.8">
<h3 data-number="6.3.8" class="anchored" data-anchor-id="share-and-publish"><span class="header-section-number">6.3.8</span> 8. Share and Publish</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Push to GitHub</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The pkgdown site can be automatically deployed to GitHub Pages</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># using GitHub Actions</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>

## Organizing scripts


Just as your data "flows" through your project, data should flow naturally through a script. Very generally, you want to:

1. describe the work completed in the script in a comment header
2. source your configuration file (`0-config.R`) 
3. load all your data 
4. do all your analysis/computation 
5. save your data. 

Each of these sections should be "chunked together" using comments. See [this file](https://github.com/kmishra9/Flu-Absenteeism/blob/master/Master's%20Thesis%20-%20Spatial%20Epidemiology%20of%20Influenza/2a%20-%20Statistical-Inputs.R) for a good example of how to cleanly organize a file in a way that follows this "flow" and functionally separate pieces of code that are doing different things.



## Testing Requirements {#sec-r-testing}

**ALWAYS establish tests BEFORE modifying functions.** This ensures changes preserve existing behavior and new behavior is correctly validated.

### When to Use Snapshot Tests

Use snapshot tests (`expect_snapshot()`, `expect_snapshot_value()`) when:

- Testing complex data structures (data frames, lists, model outputs)
- Validating statistical results where exact values may vary slightly
- Output format stability is important

```r
test_that("prep_study_data produces expected structure", {
  result &lt;- prep_study_data(raw_data)
  expect_snapshot_value(result, style = "serialize")
})</code></pre>
</section>
<section id="when-to-use-explicit-value-tests" class="level3" data-number="6.3.9">
<h3 data-number="6.3.9" class="anchored" data-anchor-id="when-to-use-explicit-value-tests"><span class="header-section-number">6.3.9</span> When to Use Explicit Value Tests</h3>
<p>Use explicit tests (<code>expect_equal()</code>, <code>expect_identical()</code>) when:</p>
<ul>
<li>Testing simple scalar outputs</li>
<li>Validating specific numeric thresholds</li>
<li>Testing Boolean returns or categorical outputs</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"calculate_mean returns correct value"</span>, {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">calculate_mean</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)), <span class="dv">2</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">calculate_ratio</span>(<span class="dv">3</span>, <span class="dv">7</span>), <span class="fl">0.4285714</span>, <span class="at">tolerance =</span> <span class="fl">1e-6</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="testing-best-practices" class="level3" data-number="6.3.10">
<h3 data-number="6.3.10" class="anchored" data-anchor-id="testing-best-practices"><span class="header-section-number">6.3.10</span> Testing Best Practices</h3>
<ul>
<li><strong>Seed randomness</strong>: Use <code>withr::local_seed()</code> for reproducible tests</li>
<li><strong>Use small test cases</strong>: Keep tests fast</li>
<li><strong>Test edge cases</strong>: Missing values, empty inputs, boundary conditions</li>
<li><strong>Test errors</strong>: Verify functions fail appropriately with invalid input</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"prep_study_data handles edge cases"</span>, {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Empty input</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_error</span>(<span class="fu">prep_study_data</span>(<span class="fu">data.frame</span>()))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Missing required columns</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_error</span>(<span class="fu">prep_study_data</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span>)))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Valid input with missing values</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">prep_study_data</span>(<span class="fu">data.frame</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="dv">3</span>)))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(result<span class="sc">$</span>value)))</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="sec-iteration" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="sec-iteration"><span class="header-section-number">6.4</span> Iterative Operations</h2>
<p>When applying analyses with different variations (outcomes, exposures, subgroups), use functional programming approaches:</p>
<section id="lapply-and-sapply" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1" class="anchored" data-anchor-id="lapply-and-sapply"><span class="header-section-number">6.4.1</span> <code>lapply()</code> and <code>sapply()</code></h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply function to each element</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(outcomes, <span class="cf">function</span>(y) {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">run_analysis</span>(data, <span class="at">outcome =</span> y)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Simplify to vector if possible</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data_list, mean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="purrrmap-family" class="level3" data-number="6.4.2">
<h3 data-number="6.4.2" class="anchored" data-anchor-id="purrrmap-family"><span class="header-section-number">6.4.2</span> <code>purrr::map()</code> Family</h3>
<p>The <code>purrr</code> package provides type-stable alternatives:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Always returns a list</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">map</span>(outcomes, <span class="sc">~</span> <span class="fu">run_analysis</span>(data, <span class="at">outcome =</span> .x))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Type-specific variants</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(data_list, mean)        <span class="co"># Returns numeric vector</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">map</span>(splits, <span class="sc">~</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> .x))  <span class="co"># Returns list of models</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="purrrpmap-for-multiple-arguments" class="level3" data-number="6.4.3">
<h3 data-number="6.4.3" class="anchored" data-anchor-id="purrrpmap-for-multiple-arguments"><span class="header-section-number">6.4.3</span> <code>purrr::pmap()</code> for Multiple Arguments</h3>
<p>When iterating over multiple parameter lists:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="fu">c</span>(<span class="st">"outcome1"</span>, <span class="st">"outcome2"</span>, <span class="st">"outcome3"</span>),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="fu">c</span>(<span class="st">"exp1"</span>, <span class="st">"exp2"</span>, <span class="st">"exp3"</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">covariate_set =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"sex"</span>), <span class="fu">c</span>(<span class="st">"age"</span>), <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"bmi"</span>))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">pmap</span>(params, <span class="cf">function</span>(outcome, exposure, covariate_set) {</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">run_analysis</span>(</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> study_data,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> outcome,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure =</span> exposure,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">covariates =</span> covariate_set</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="parallel-processing" class="level3" data-number="6.4.4">
<h3 data-number="6.4.4" class="anchored" data-anchor-id="parallel-processing"><span class="header-section-number">6.4.4</span> Parallel Processing</h3>
<p>For computationally intensive work, use <code>future</code> and <code>furrr</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(future)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up parallel processing</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="fu">availableCores</span>() <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Parallel version of map()</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">future_map</span>(large_list, time_consuming_function, <span class="at">.progress =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="sec-data-io" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="sec-data-io"><span class="header-section-number">6.5</span> Reading and Saving Data</h2>
<section id="rds-files-preferred" class="level3" data-number="6.5.1">
<h3 data-number="6.5.1" class="anchored" data-anchor-id="rds-files-preferred"><span class="header-section-number">6.5.1</span> RDS Files (Preferred)</h3>
<p>Use RDS format for R objects:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save single object</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(analysis_results, <span class="fu">here</span>(<span class="st">"results"</span>, <span class="st">"analysis.rds"</span>))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read back</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="fu">here</span>(<span class="st">"results"</span>, <span class="st">"analysis.rds"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Avoid <code>.RData</code> files</strong> because: - You canâ€™t control object names when loading - Canâ€™t load individual objects - Creates confusion in older code</p>
</section>
<section id="csv-files" class="level3" data-number="6.5.2">
<h3 data-number="6.5.2" class="anchored" data-anchor-id="csv-files"><span class="header-section-number">6.5.2</span> CSV Files</h3>
<p>For tabular data that may be shared with non-R users:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(data, <span class="fu">here</span>(<span class="st">"data-raw"</span>, <span class="st">"clean_data.csv"</span>))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data-raw"</span>, <span class="st">"clean_data.csv"</span>))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># For very large files, use data.table</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">fwrite</span>(large_data, <span class="st">"big_file.csv"</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">"big_file.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="sec-r-version-control" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="sec-r-version-control"><span class="header-section-number">6.6</span> Version Control and Collaboration</h2>
<section id="version-numbers" class="level3" data-number="6.6.1">
<h3 data-number="6.6.1" class="anchored" data-anchor-id="version-numbers"><span class="header-section-number">6.6.1</span> Version Numbers</h3>
<p>Follow semantic versioning (MAJOR.MINOR.PATCH):</p>
<ul>
<li>Development versions: <code>0.0.0.9000</code>, <code>0.0.0.9001</code>, etc.</li>
<li>First release: <code>0.1.0</code></li>
<li>Bug fixes: increment PATCH (e.g., <code>0.1.0</code> â†’ <code>0.1.1</code>)</li>
<li>New features: increment MINOR (e.g., <code>0.1.1</code> â†’ <code>0.2.0</code>)</li>
<li>Breaking changes: increment MAJOR (e.g., <code>0.2.0</code> â†’ <code>1.0.0</code>)</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Increment version</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_version</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="news-file" class="level3" data-number="6.6.2">
<h3 data-number="6.6.2" class="anchored" data-anchor-id="news-file"><span class="header-section-number">6.6.2</span> NEWS File</h3>
<p>Document all user-facing changes in <code>NEWS.md</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># myproject 0.2.0</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">## Continuous Integration {#sec-r-ci}</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>Set up automated checks using GitHub Actions:</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add standard R package CI workflows</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_github_action</span>(<span class="st">"check-standard"</span>)    <span class="co"># R CMD check</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_github_action</span>(<span class="st">"test-coverage"</span>)     <span class="co"># Code coverage</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_github_action</span>(<span class="st">"pkgdown"</span>)           <span class="co"># Deploy website</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>These workflows automatically:</p>
<ul>
<li>Run R CMD check on multiple platforms (Linux, macOS, Windows)</li>
<li>Calculate test coverage</li>
<li>Build and deploy your pkgdown website</li>
<li>Ensure code quality before merging</li>
</ul>
</section>
</section>
<section id="sec-r-qa-checklist" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="sec-r-qa-checklist"><span class="header-section-number">6.7</span> Quality Assurance Checklist</h2>
<p>Before submitting a pull request or finalizing analysis, verify:</p>
<ul class="task-list">
<li><label><input type="checkbox">All functions have complete roxygen2 documentation</label></li>
<li><label><input type="checkbox">All functions have corresponding tests</label></li>
<li><label><input type="checkbox"><code>devtools::document()</code> has been run</label></li>
<li><label><input type="checkbox"><code>devtools::test()</code> passes with no failures</label></li>
<li><label><input type="checkbox"><code>devtools::check()</code> passes with no errors, warnings, or notes</label></li>
<li><label><input type="checkbox"><code>lintr::lint_package()</code> shows no issues (or only acceptable ones)</label></li>
<li><label><input type="checkbox"><code>spelling::spell_check_package()</code> passes</label></li>
<li><label><input type="checkbox">Version number has been incremented</label></li>
<li><label><input type="checkbox"><code>NEWS.md</code> has been updated with changes</label></li>
<li><label><input type="checkbox"><code>README.Rmd</code> has been updated (if needed) and <code>README.md</code> regenerated</label></li>
<li><label><input type="checkbox"><code>pkgdown::build_site()</code> builds successfully</label></li>
<li><label><input type="checkbox">All changes committed and pushed to GitHub</label></li>
</ul>
</section>
<section id="sec-auto-styling" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="sec-auto-styling"><span class="header-section-number">6.8</span> Automated Code Styling</h2>
<section id="rstudio-built-in-formatting" class="level3" data-number="6.8.1">
<h3 data-number="6.8.1" class="anchored" data-anchor-id="rstudio-built-in-formatting"><span class="header-section-number">6.8.1</span> RStudio Built-in Formatting</h3>
<p>Use RStudioâ€™s built-in autoformatter (keyboard shortcut: <code>CMD-Shift-A</code> or <code>Ctrl-Shift-A</code>) to quickly format highlighted code.</p>
</section>
<section id="styler-package" class="level3" data-number="6.8.2">
<h3 data-number="6.8.2" class="anchored" data-anchor-id="styler-package"><span class="header-section-number">6.8.2</span> styler Package</h3>
<p>For automated styling of entire projects:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install styler</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"styler"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Style all files in R/ directory</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>styler<span class="sc">::</span><span class="fu">style_dir</span>(<span class="st">"R/"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Style entire package</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>styler<span class="sc">::</span><span class="fu">style_pkg</span>()</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: styler modifies files in-place</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Always use with version control so you can review changes</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="lintr-package" class="level3" data-number="6.8.3">
<h3 data-number="6.8.3" class="anchored" data-anchor-id="lintr-package"><span class="header-section-number">6.8.3</span> lintr Package</h3>
<p>For checking code style without modifying files:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install lintr</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"lintr"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Lint the entire package</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>lintr<span class="sc">::</span><span class="fu">lint_package</span>()</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Lint a specific file</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>lintr<span class="sc">::</span><span class="fu">lint</span>(<span class="st">"R/my_function.R"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The linter checks for:</p>
<ul>
<li>Unused variables</li>
<li>Improper whitespace</li>
<li>Line length issues</li>
<li>Style guide violations</li>
</ul>
<p>You can customize linting rules by creating a <code>.lintr</code> file in your project root.</p>
<p>See also <a href="06-coding-style.html#sec-style-auto-style" class="quarto-xref"><span>Section 7.11</span></a>.</p>
</section>
</section>
<section id="sec-documenting-code" class="level2" data-number="6.9">
<h2 data-number="6.9" class="anchored" data-anchor-id="sec-documenting-code"><span class="header-section-number">6.9</span> Documenting your code</h2>
<section id="function-headers" class="level3" data-number="6.9.1">
<h3 data-number="6.9.1" class="anchored" data-anchor-id="function-headers"><span class="header-section-number">6.9.1</span> Function headers</h3>
<p>Every function you write must include a header to document its purpose, inputs, and outputs. For any reproducible workflows, they are essential, because R is dynamically typed. This means, you can pass a <code>string</code> into an argument that is meant to be a <code>data.table</code>, or a <code>list</code> into an argument meant for a <code>tibble</code>. It is the responsibility of a functionâ€™s author to document what each argument is meant to do and its basic type. This is an example for documenting a function (inspired by <a href="https://www.oracle.com/technetwork/java/javase/documentation/index-137868.html#format">JavaDocs</a> and Râ€™s <a href="https://blog.rstudio.com/2018/10/23/rstudio-1-2-preview-plumber-integration/">Plumber API docs</a>):</p>
<pre><code>##############################################
##############################################
# Documentation: calc_fluseas_mean
# Usage: calc_fluseas_mean(data, yname)
# Description: Make a dataframe with rows for flu season and site
# and the number of patients with an outcome, the total patients,
# and the percent of patients with the outcome

# Args/Options:
# data: a data frame with variables flu_season, site, studyID, and yname
# yname: a string for the outcome name
# silent: a boolean specifying whether the function shouldn't output anything to the console (DEFAULT: TRUE)

# Returns: the dataframe as described above
# Output: prints the data frame described above if silent is not True

calc_fluseas_mean &lt;- function(data, yname, silent = TRUE) {
 ### function code here

}</code></pre>
<p>The header tells you what the function does, its various inputs, and how you might go about using the function to do what you want. Also notice that all optional arguments (i.e.&nbsp;ones with pre-specified defaults) follow arguments that require user input.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>As someone trying to call a function, it is possible to access a functionâ€™s documentation (and internal code) by <code>CMD-Left-Click</code>ing the functionâ€™s name in RStudio</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Depending on how important your function is, the complexity of your function code, and the complexity of different types of data in your project, you can also add â€œtype-checkingâ€ to your function with the <code>assertthat::assert_that()</code> function. You can, for example, <code>assert_that(is.data.frame(statistical_input))</code>, which will ensure that collaborators or reviewers of your project attempting to use your function are using it in the way that it is intended by calling it with (at the minimum) the correct type of arguments. You can extend this to ensure that certain assumptions regarding the inputs are fulfilled as well (i.e.&nbsp;that <code>time_column</code>, <code>location_column</code>, <code>value_column</code>, and <code>population_column</code> all exist within the <code>statistical_input</code> tibble).</p>
</div>
</div>
</section>
<section id="script-headers" class="level3" data-number="6.9.2">
<h3 data-number="6.9.2" class="anchored" data-anchor-id="script-headers"><span class="header-section-number">6.9.2</span> Script headers</h3>
<p>Every file in a project that doesnâ€™t have roxygen function documentation should at least have a header that allows it to be interpreted on its own. It should include the name of the project and a short description for what this file (among the many in your project) does specifically. You may optionally wish to include the inputs and outputs of the script as well, though the next section makes this significantly less necessary.</p>
<pre><code>################################################################################
# @Organization - Example Organization
# @Project - Example Project
# @Description - This file is responsible for [...]
################################################################################
</code></pre>
</section>
<section id="sections-and-subsections" class="level3" data-number="6.9.3">
<h3 data-number="6.9.3" class="anchored" data-anchor-id="sections-and-subsections"><span class="header-section-number">6.9.3</span> Sections and subsections</h3>
<p>Rstudio (<a href="https://blog.rstudio.com/2020/12/02/rstudio-v1-4-preview-little-things/">v1.4 or more recent</a>) supports the use of Sections and Subsections. You can easily navigate through longer scripts using the navigation pane in RStudio, as shown on the right below.</p>
<pre><code># Section -------

## Subsection -------

### Sub-subsection -------</code></pre>
</section>
<section id="code-folding" class="level3" data-number="6.9.4">
<h3 data-number="6.9.4" class="anchored" data-anchor-id="code-folding"><span class="header-section-number">6.9.4</span> Code folding</h3>
<p>Consider using RStudioâ€™s <a href="https://support.rstudio.com/hc/en-us/articles/200484568-Code-Folding-and-Sections">code folding</a> feature to collapse and expand different sections of your code. Any comment line with at least four trailing dashes (-), equal signs (=), or pound signs (#) automatically creates a code section. For example:</p>
</section>
<section id="comments-in-the-body-of-your-code" class="level3" data-number="6.9.5">
<h3 data-number="6.9.5" class="anchored" data-anchor-id="comments-in-the-body-of-your-code"><span class="header-section-number">6.9.5</span> Comments in the body of your code</h3>
<p>Commenting your code is an important part of reproducibility and helps document your code for the future. When things change or break, youâ€™ll be thankful for comments. Thereâ€™s no need to comment excessively or unnecessarily, but a comment describing what a large or complex chunk of code does is always helpful. See <a href="https://github.com/kmishra9/Flu-Absenteeism/blob/master/Master's%20Thesis%20-%20Spatial%20Epidemiology%20of%20Influenza/1b%20-%20Map-Management.R">this file</a> for an example of how to comment your code and notice that comments are always in the form of:</p>
<pre><code># This is a comment -- first letter is capitalized and spaced away from the pound sign</code></pre>
<p><em>See also <a href="06-coding-style.html#sec-function-docs" class="quarto-xref"><span>Section 7.2</span></a> for function documentation style guidelines.</em></p>
</section>
</section>
<section id="object-naming" class="level2" data-number="6.10">
<h2 data-number="6.10" class="anchored" data-anchor-id="object-naming"><span class="header-section-number">6.10</span> Object naming</h2>
<p>Generally we recommend using nouns for objects and verbs for functions. This is because functions are performing actions, while objects are not.</p>
<p>Try to make your variable names both more expressive and more explicit. Being a bit more verbose is useful and easy in the age of autocompletion! For example, instead of naming a variable <code>vaxcov_1718</code>, try naming it <code>vaccination_coverage_2017_18</code>. Similarly, <code>flu_res</code> could be named <code>absentee_flu_residuals</code>, making your code more readable and explicit.</p>
<ul>
<li>For more help, check out <a href="https://spin.atomicobject.com/2017/11/01/good-variable-names/">Be Expressive: How to Give Your Variables Better Names</a></li>
</ul>
<p>We recommend you use <strong>snake_case</strong>.</p>
<ul>
<li>Base R allows <code>.</code> in variable names and functions (such as <code>read.csv()</code>), but this goes against best practices for variable naming in many other coding languages. For consistencyâ€™s sake, <code>snake_case</code> has been adopted across languages, and modern packages and functions typically use it (i.e.&nbsp;<code>readr::read_csv()</code>). As a very general rule of thumb, if a package youâ€™re using doesnâ€™t use <code>snake_case</code>, there may be an updated version or more modern package that <em>does</em>, bringing with it the variety of performance improvements and bug fixes inherent in more mature and modern software.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You may also see <code>camelCase</code> throughout the R code you come across. This is <em>okay</em> but not ideal â€“ try to stay consistent across all your code with <code>snake_case</code>.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Again, itâ€™s also worth noting thereâ€™s nothing inherently wrong with using <code>.</code> in variable names, just that it goes against style best practices that are cropping up in data science, so itâ€™s worth getting rid of these bad habits now.</p>
</div>
</div>
<p>See also <a href="06-coding-style.html#sec-object-naming" class="quarto-xref"><span>Section 7.10</span></a>.</p>
</section>
<section id="function-calls" class="level2" data-number="6.11">
<h2 data-number="6.11" class="anchored" data-anchor-id="function-calls"><span class="header-section-number">6.11</span> Function calls</h2>
<p>In a function call, use â€œnamed argumentsâ€ and put each argument on a separate line to make your code more readable.</p>
<p>Hereâ€™s an example of what not to do when calling the function a function <code>calc_fluseas_mean</code> (defined above):</p>
<pre><code>mean_Y = calc_fluseas_mean(flu_data, "maari_yn", FALSE)</code></pre>
<p>And here it is again using the best practices weâ€™ve outlined:</p>
<pre><code>mean_Y &lt;- calc_fluseas_mean(
  data = flu_data, 
  yname = "maari_yn",
  silent = FALSE
)</code></pre>
</section>
<section id="sec-here-package-practices" class="level2" data-number="6.12">
<h2 data-number="6.12" class="anchored" data-anchor-id="sec-here-package-practices"><span class="header-section-number">6.12</span> The here package</h2>
<p>The <code>here</code> package is one great R package that helps multiple collaborators deal with the mess that is working directories within an R project structure. Letâ€™s say we have an R project at the path <code>/home/oski/Some-R-Project</code>. My collaborator might clone the repository and work with it at some other path, such as <code>/home/bear/R-Code/Some-R-Project</code>. Dealing with working directories and paths explicitly can be a very large pain, and as you might imagine, setting up a Config with paths requires those paths to flexibly work for all contributors to a project. This is where the <code>here</code> package comes in and this a <a href="https://github.com/jennybc/here_here">great vignette describing it</a>.</p>
<p><em>See also <a href="06-coding-style.html#sec-here-package-style" class="quarto-xref"><span>Section 7.9</span></a> for code style guidelines on using the here package.</em></p>
</section>
<section id="readingsaving-data" class="level2" data-number="6.13">
<h2 data-number="6.13" class="anchored" data-anchor-id="readingsaving-data"><span class="header-section-number">6.13</span> Reading/Saving Data</h2>
<section id="rds-vs-.rdata-files" class="level3" data-number="6.13.1">
<h3 data-number="6.13.1" class="anchored" data-anchor-id="rds-vs-.rdata-files"><span class="header-section-number">6.13.1</span> <code>.RDS</code> vs <code>.RData</code> Files</h3>
<p>One of the most common ways to load and save data in Base R is with the <code>load()</code> and <code>save()</code> functions to serialize multiple objects in a single <code>.RData</code> file. The biggest problems with this practice include an inability to control the names of things getting loaded in, the inherent confusion this creates in understanding older code, and the inability to load individual elements of a saved file. For this, we recommend using the RDS format to save R objects.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you have many related R objects you would have otherwise saved all together using the <code>save</code> function, the functional equivalent with <code>RDS</code> would be to create a (named) list containing each of these objects, and saving it.</p>
</div>
</div>
</section>
<section id="csvs" class="level3" data-number="6.13.2">
<h3 data-number="6.13.2" class="anchored" data-anchor-id="csvs"><span class="header-section-number">6.13.2</span> CSVs</h3>
<p>Once again, the <code>readr</code> package as part of the Tidvyerse is great, with a much faster <code>read_csv()</code> than Base Râ€™s <code>read.csv()</code>. For massive CSVs (&gt; 5 GB), youâ€™ll find <code>data.table::fread()</code> to be the fastest CSV reader in any data science language out there. For writing CSVs, <code>readr::write_csv()</code> and <code>data.table::fwrite()</code> outclass Base Râ€™s <code>write.csv()</code> by a significant margin as well.</p>
</section>
</section>
<section id="integrating-box-and-dropbox" class="level2" data-number="6.14">
<h2 data-number="6.14" class="anchored" data-anchor-id="integrating-box-and-dropbox"><span class="header-section-number">6.14</span> Integrating Box and Dropbox</h2>
<p>Box and Dropbox are cloud-based file sharing systems that are useful when dealing with large files. When our scripts generate large output files, the files can slow down the workflow if they are pushed to GitHub. This makes collaboration difficult when not everyone has a copy of the file, unless we decide to duplicate files and share them manually. The files might also take up a lot of local storage. Box and Dropbox help us avoid these issues by automatically storing the files, reading data, and writing data back to the cloud.</p>
<p>Box and Dropbox are separate platforms, but we can use either one to store and share files. To use them, we can install the packages that have been created to integrate Box and Dropbox into R. The set-up instructions are detailed below.</p>
<p>Make sure to authenticate before reading and writing from either Box or Dropbox. The authentication commands should go in the configuration file; it only needs to be done once. This will prompt you to give your login credentials for Box and Dropbox and will allow your application to access your shared folders.</p>
<section id="box" class="level3" data-number="6.14.1">
<h3 data-number="6.14.1" class="anchored" data-anchor-id="box"><span class="header-section-number">6.14.1</span> Box</h3>
<p>Follow the instructions in this section to use the <code>boxr</code> package. Note that there are a few setup steps that need to be done on the box website before you can use the <code>boxr</code> package, <a href="https://r-box.github.io/boxr/articles/boxr-app-interactive.html#create">explained here</a> in the section â€œCreating an Interactive App.â€ This gets the authentication keys that must be put in box. Once that is done, add the authentication keys to your code in the configuration file, with <code>box_auth(client_id = "&lt;your_client_id&gt;", client_secret = "&lt;your_client_secret_id&gt;")</code>. It is also important to set the default working directory so that the code can reference the correct folder in box: <code>box_setwd(&lt;folder_id&gt;)</code>. The folder ID is the sequence of digits at the end of the URL.</p>
<p>Further details can be found <a href="https://github.com/r-box/boxr">here</a>.</p>
</section>
<section id="dropbox" class="level3" data-number="6.14.2">
<h3 data-number="6.14.2" class="anchored" data-anchor-id="dropbox"><span class="header-section-number">6.14.2</span> Dropbox</h3>
<p>Follow the instructions at <a href="https://github.com/karthik/rdrop2">this link</a> to use the <code>rdrop2</code> package. Similar to the <code>boxr</code> package, you must authenticate before reading and writing from Dropbox, which can be done by adding <code>drop_auth()</code> to the configuration file.</p>
<p>Saving the authentication token is not required, although it may be useful if you plan on using Dropbox frequently. To do so, save the token with the following commands. Tokens are valid until they are manually revoked.</p>
<pre><code># first time only
# save the output of drop_auth to an RDS file
token &lt;- drop_auth()
# this token only has to be generated once, it is valid until revoked
saveRDS(token, "/path/to/tokenfile.RDS")

# all future usages
# to use a stored token, provide the rdstoken argument
drop_auth(rdstoken = "/path/to/tokenfile.RDS")
</code></pre>
</section>
</section>
<section id="sec-tidyverse" class="level2" data-number="6.15">
<h2 data-number="6.15" class="anchored" data-anchor-id="sec-tidyverse"><span class="header-section-number">6.15</span> Tidyverse</h2>
<p>Throughout this document there have been references to the Tidyverse, but this section is to explicitly show you how to transform your Base R tendencies to Tidyverse (or Data.Table, Tidyverseâ€™s performance-optimized competitor). For most of our work that does not utilize very large datasets, we recommend that you code in Tidyverse rather than Base R. Tidyverse is quickly becoming <a href="https://rviews.rstudio.com/2017/06/08/what-is-the-tidyverse/">the gold standard</a> in R data analysis and modern data science packages and code should use Tidyverse style and packages unless thereâ€™s a significant reason not to (i.e.&nbsp;big data pipelines that would benefit from Data.Tableâ€™s performance optimizations).</p>
<p>The package author has published a <a href="https://r4ds.had.co.nz/">great textbook on R for Data Science</a>, which leans heavily on many Tidyverse packages and may be worth checking out.</p>
<p>The following list is not exhaustive, but is a compact overview to begin to translate Base R into something better:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Base R</th>
<th>Better Style, Performance, and Utility</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>_</td>
<td>_</td>
</tr>
<tr class="even">
<td><code>read.csv()</code></td>
<td><code>readr::read_csv()</code> or <code>data.table::fread()</code></td>
</tr>
<tr class="odd">
<td><code>write.csv()</code></td>
<td><code>readr::write_csv()</code> or <code>data.table::fwrite()</code></td>
</tr>
<tr class="even">
<td><code>readRDS</code></td>
<td><code>readr::read_rds()</code></td>
</tr>
<tr class="odd">
<td><code>saveRDS()</code></td>
<td><code>readr::write_rds()</code></td>
</tr>
<tr class="even">
<td>_</td>
<td>_</td>
</tr>
<tr class="odd">
<td><code>data.frame()</code></td>
<td><code>tibble::tibble()</code> or <code>tibble::tribble()</code></td>
</tr>
<tr class="even">
<td><code>rbind()</code></td>
<td><code>dplyr::bind_rows()</code></td>
</tr>
<tr class="odd">
<td><code>cbind()</code></td>
<td><code>dplyr::bind_cols()</code></td>
</tr>
<tr class="even">
<td><code>df$some_column</code></td>
<td><code>df |&gt; dplyr::pull(some_column)</code></td>
</tr>
<tr class="odd">
<td><code>df$some_column = ...</code></td>
<td><code>df |&gt; dplyr::mutate(some_column = ...)</code></td>
</tr>
<tr class="even">
<td><code>df[get_rows_condition,]</code></td>
<td><code>df |&gt; dplyr::filter(get_rows_condition)</code></td>
</tr>
<tr class="odd">
<td><code>df[,c(col1, col2)]</code></td>
<td><code>df |&gt; dplyr::select(col1, col2)</code></td>
</tr>
<tr class="even">
<td><code>merge(df1, df2, by = ..., all.x = ..., all.y = ...)</code></td>
<td><code>df1 |&gt; dplyr::left_join(df2, by = ...)</code> or <code>dplyr::full_join</code> or <code>dplyr::inner_join</code> or <code>dplyr::right_join</code></td>
</tr>
<tr class="odd">
<td>_</td>
<td>_</td>
</tr>
<tr class="even">
<td><code>str()</code></td>
<td><code>dplyr::glimpse()</code></td>
</tr>
<tr class="odd">
<td><code>grep(pattern, x)</code></td>
<td><code>stringr::str_which(string, pattern)</code></td>
</tr>
<tr class="even">
<td><code>gsub(pattern, replacement, x)</code></td>
<td><code>stringr::str_replace(string, pattern, replacement)</code></td>
</tr>
<tr class="odd">
<td><code>ifelse(test_expression, yes, no)</code></td>
<td><code>if_else(condition, true, false)</code></td>
</tr>
<tr class="even">
<td>Nested: <code>ifelse(test_expression1, yes1, ifelse(test_expression2, yes2, ifelse(test_expression3, yes3, no)))</code></td>
<td><code>case_when(test_expression1 ~ yes1,  test_expression2 ~ yes2, test_expression3 ~ yes3, TRUE ~ no)</code></td>
</tr>
<tr class="odd">
<td><code>proc.time()</code></td>
<td><code>tictoc::tic()</code> and <code>tictoc::toc()</code></td>
</tr>
<tr class="even">
<td><code>stopifnot()</code></td>
<td><code>assertthat::assert_that()</code> or <code>assertthat::see_if()</code> or <code>assertthat::validate_that()</code></td>
</tr>
<tr class="odd">
<td>_</td>
<td>_</td>
</tr>
<tr class="even">
<td><code>sessionInfo()</code></td>
<td><code>sessioninfo::session_info()</code></td>
</tr>
</tbody>
</table>
<p>For a more extensive set of syntactical translations to Tidyverse, you can check out <a href="https://tavareshugo.github.io/data_carpentry_extras/base-r_tidyverse_equivalents/base-r_tidyverse_equivalents.html#reshaping_data">this document</a>.</p>
<p>Working with Tidyverse within functions can be somewhat of a pain due to non-standard evaluation (NSE) semantics. If youâ€™re an avid function writer, weâ€™d recommend checking out the following resources:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=nERXS3ssntw">Tidy Eval in 5 Minutes</a> (video)</li>
<li><a href="https://tidyeval.tidyverse.org/index.html">Tidy Evaluation</a> (e-book)</li>
<li><a href="https://www.brodrigues.co/blog/2016-07-18-data-frame-columns-as-arguments-to-dplyr-functions/">Data Frame Columns as Arguments to Dplyr Functions</a> (blog)</li>
<li><a href="https://stackoverflow.com/questions/28125816/r-standard-evaluation-for-join-dplyr">Standard Evaluation for *_join</a> (stackoverflow)</li>
<li><a href="https://dplyr.tidyverse.org/articles/programming.html">Programming with dplyr</a> (package vignette)</li>
</ul>
<p>See also <a href="06-coding-style.html#sec-tidyverse-replacements" class="quarto-xref"><span>Section 7.8</span></a></p>
</section>
<section id="coding-with-r-and-python" class="level2" data-number="6.16">
<h2 data-number="6.16" class="anchored" data-anchor-id="coding-with-r-and-python"><span class="header-section-number">6.16</span> Coding with R and Python</h2>
<p>If youâ€™re using both R and Python, you may wish to check out the <a href="https://www.rdocumentation.org/packages/feather/versions/0.3.3">Feather package</a> for exchanging data between the two languages <a href="https://blog.rstudio.com/2016/03/29/feather/">extremely quickly</a>.</p>
</section>
<section id="repeating-analyses-with-different-variations" class="level2" data-number="6.17">
<h2 data-number="6.17" class="anchored" data-anchor-id="repeating-analyses-with-different-variations"><span class="header-section-number">6.17</span> Repeating analyses with different variations</h2>
<p>In many cases, we will need to apply our modeling on different combinations of interests (outcomes, exposures, etc.). We can certainly use a <code>for</code> loop to repeat the execution of a wrapper function, but generally, <code>for</code> loops request high memory usage and produce the results in long computation time.</p>
<p>Fortunately, R has some functions which implement looping in a compact form to help repeating your analyses with different variations (subgroups, outcomes, covariate sets, etc.) with better performances.</p>
<section id="lapply-and-sapply-1" class="level3" data-number="6.17.1">
<h3 data-number="6.17.1" class="anchored" data-anchor-id="lapply-and-sapply-1"><span class="header-section-number">6.17.1</span> <code>lapply()</code> and <code>sapply()</code></h3>
<p><code>lapply()</code> is a function in the base R package that applies a function to each element of a list and returns a list. Itâ€™s typically faster than <code>for</code>. Here is a simple generic example:</p>
<pre><code>result &lt;- lapply(X = mylist, FUN = func)</code></pre>
<p>There is another very similar function called <code>sapply()</code>. It also takes a list as its input, but if the output of the <code>func</code> is of the same length for each element in the input list, then <code>sapply()</code> will simplify the output to the simplest data structure possible, which will usually be a vector.</p>
</section>
<section id="mapply-and-pmap" class="level3" data-number="6.17.2">
<h3 data-number="6.17.2" class="anchored" data-anchor-id="mapply-and-pmap"><span class="header-section-number">6.17.2</span> <code>mapply()</code> and <code>pmap()</code></h3>
<p>Sometimes, weâ€™d like to employ a wrapper function that takes arguments from multiple different lists/vectors. Then, we can consider using <code>mapply()</code> from the base R package or <code>pmap()</code> from the <code>purrr</code> package.</p>
<p>Please see the simple specific example below where the two input lists are of the same length and we are doing a pairwise calculation:</p>
<pre><code>mylist1 = list(0:3)
mylist2 = list(6:9)
mylists = list(mylist1, mylist2)

square_sum &lt;- function(x, y) {
  x^2 + y^2
}

#Use `mapply()`
result1 &lt;- mapply(FUN = square_sum, mylist1, mylist2)

#Use `pmap()`
library(purrr)
result2 &lt;- pmap(.l = mylists, .f = square_sum)

#unlist(as.list(result1)) = result2 = [36 50 68 90]
</code></pre>
<p>There are two major differences between <code>mapply()</code> and <code>pmap()</code>. The first difference is that <code>mapply()</code> takes seperate lists as its input arguments, while <code>pmap()</code> takes a list of list. Secondly, the output of <code>mapply()</code> will be in the form of a matrix or an array, but <code>pmap()</code> produces a list directly.</p>
<p>However, when <strong>the input lists are of different lengths AND/OR the wrapper function doesnâ€™t take arguments in pairs, <code>mapply()</code> and <code>pmap()</code> may not give the preferable results.</strong></p>
<p>Both <code>mapply()</code> and <code>pmap()</code> will recycle shorter input lists to match the length of the longest input list. Assume that now <code>mylist2 = list(6:12)</code>. Then, <code>pmap(mylists, square_sum)</code> will generate <code>[36  50  68  90 100 122 148]</code> where elements 0, 1, and 2 are recycled to match 10, 11, and 12. And it will return an error message that â€œlonger object length is not a multiple of shorter object length.â€</p>
<p>Thus, unless the recycling pattern described above is desirable feature for a certain experiment design, <strong>when the input lists are of different lengths, the best practice is probably to use <code>lapply()</code> and then combine the results.</strong></p>
<p>Here is an example where weâ€™d like to find the <code>square_sum</code> for every element combination of <code>mylist1</code> and <code>mylist2</code>.</p>
<pre><code>mylist1 &lt;- list(0:3)
mylist2 &lt;- list(6:12)

square_sum &lt;- function(x, y) {
  x^2 + y^2
}

results &lt;- list()

for (i in seq_along(mylist1[[1]])) {
  result &lt;- lapply(X = mylist2, FUN = function(y) square_sum(mylist1[[1]][i], y))
  results[[i]] &lt;- result
}
</code></pre>
<p>This example doesnâ€™t work in the way that 0 is paired to 6, 1 is paired to 7, and so on. Instead, every element in <code>mylist1</code> will be paired with every element in <code>mylist2</code>. Thus, the â€œunlistedâ€ results from the example will have <span class="math inline">\(4*7 = 28\)</span> elements.</p>
<p>We can use <code>flatten()</code> or <code>unlist()</code> functions to decrease the depths of our results. If the results are data frames, then we will need to use <code>bind_rows()</code> to combine them.</p>
</section>
<section id="parallel-processing-with-parallel-and-future-packages" class="level3" data-number="6.17.3">
<h3 data-number="6.17.3" class="anchored" data-anchor-id="parallel-processing-with-parallel-and-future-packages"><span class="header-section-number">6.17.3</span> Parallel processing with <code>parallel</code> and <code>future</code> packages</h3>
<p>One big drawback of <code>lapply()</code> is its long computation time, especially when the list length is long. Fortunately, computers nowadays must have multiple cores which makes parallel processing possible to help make computation much faster.</p>
<p>Assume you have a list called <code>mylist</code> of length 1000, and <code>lapply(X = mylist, FUN = func)</code> applies the function to each of the 1000 elements one by one in <span class="math inline">\(T\)</span> seconds. If we could execute the <code>func</code> in <span class="math inline">\(n\)</span> processors simultaneously, then ideally, we would shrink the computation time to <span class="math inline">\(T/n\)</span> seconds.</p>
<p>In practice, using functions under the <code>parallel</code> and the <code>future</code> packages, we can split <code>mylist</code> into smaller chunks and apply the function to each element of the several chunks in parallel in different cores to significantly reduce the run time.</p>
<section id="parlapply" class="level4" data-number="6.17.3.1">
<h4 data-number="6.17.3.1" class="anchored" data-anchor-id="parlapply"><span class="header-section-number">6.17.3.1</span> <code>parLapply()</code></h4>
<p>Below is a generic example of <code>parLapply()</code>:</p>
<pre><code>library(parallel)

# Set how many processors will be used to process the list and make cluster
n_cores &lt;- 4
cl &lt;- makeCluster(n_cores)

#Use parLapply() to apply func to each element in mylist
result &lt;- parLapply(cl = cl, x = mylist, FUN = func)

#Stop the parallel processing
stopCluster(cl)</code></pre>
<p>Letâ€™s still assume <code>mylist</code> is of length 1000. The <code>parLapply</code> above splits <code>mylist</code> into 4 sub-lists each of length 250 and applies the function to the elements of each sub-list in parallel. To be more specific, first apply the function to element 1, 251, 501, 751; second apply to element 2, 252, 502, 752; so on and so forth. As such, the computation time will be greatly reduced.</p>
<p>You can use <code>parallel::detectCores()</code> to test how many cores your machine has and to help decide what to put for <code>n_cores</code>. It would be a good idea to leave at least one core free for the operating system to use.</p>
<p>We will always start <code>parLapply()</code> with <code>makeCluster()</code>. <strong><code>stopCluster()</code> is not fully necessary but follows the best practices.</strong> If not stopped, the processing will continue in the back end and consuming the computation capacity for other software in your machine. But keep in mind that stopping the cluster is similar quitting R, meaning that you will need to re-load the packages needed when you need to do parallel processing use <code>parLapply()</code> again.</p>
</section>
<section id="future.lapply" class="level4" data-number="6.17.3.2">
<h4 data-number="6.17.3.2" class="anchored" data-anchor-id="future.lapply"><span class="header-section-number">6.17.3.2</span> <code>future.lapply()</code></h4>
<p>Below is a generic example of <code>future.lapply()</code>:</p>
<pre><code>library(future)
library(future.apply)

# First, plan how the future_lapply() will be resolved
future::plan(
  multisession, workers = future::availableCores() - 1
)

# Use future_lapply() to apply func to each element in mylist
future_lapply(x = mylist, FUN = func)</code></pre>
<p>Here, <code>future::availableCores()</code> checks how many cores your machine has. Similar to <code>parLapply()</code> showed above, <code>future_lapply()</code> parallelizes the computation of <code>lapply()</code> by executing the function <code>func</code> simultaneously on different sub-lists of <code>mylist</code>.</p>
</section>
</section>
</section>
<section id="reviewing-code" class="level2" data-number="6.18">
<h2 data-number="6.18" class="anchored" data-anchor-id="reviewing-code"><span class="header-section-number">6.18</span> Reviewing Code</h2>
<p>Before publishing new changes, it is important to ensure that the code has been tested and well-documented. GitHub makes it possible to document all of these changes in a pull request. Pull requests can be used to describe changes in a branch that are ready to be merged with the base branch (more information in the <a href="#Github">GitHub</a> section).</p>
<p>This section provides guidance on both constructing effective pull requests and reviewing code submitted by others. Much of the content in this section is adapted from the <a href="https://code-review.tidyverse.org/">tidyverse code review guide</a>, which provides excellent principles for code review in R package development.</p>
</section>
<section id="constructing-pull-requests" class="level2" data-number="6.19">
<h2 data-number="6.19" class="anchored" data-anchor-id="constructing-pull-requests"><span class="header-section-number">6.19</span> Constructing Pull Requests</h2>
<section id="write-focused-prs" class="level3" data-number="6.19.1">
<h3 data-number="6.19.1" class="anchored" data-anchor-id="write-focused-prs"><span class="header-section-number">6.19.1</span> Write Focused PRs</h3>
<p>A focused pull request is <strong>one self-contained change</strong> that addresses just one thing. Writing focused PRs has several benefits:</p>
<ul>
<li><strong>Faster reviews</strong>: Itâ€™s easier for a reviewer to find 5-10 minutes to review a single bug fix than to set aside an hour for one large PR implementing many features.</li>
<li><strong>More thorough reviews</strong>: Large PRs with many changes can overwhelm reviewers, leading to important points being missed.</li>
<li><strong>Fewer bugs</strong>: Smaller changes make it easier to reason about impacts and identify potential issues.</li>
<li><strong>Easier to merge</strong>: Large PRs take longer and are more likely to have merge conflicts.</li>
<li><strong>Less wasted work</strong>: If the overall direction is wrong, youâ€™ve wasted less time on a small PR.</li>
</ul>
<p>As a guideline, 100 lines is usually a reasonable size for a PR, and 1000 lines is usually too large. However, the number of files affected also mattersâ€”a 200-line change in one file might be fine, but the same change spread across 50 files is usually too large.</p>
</section>
<section id="writing-pr-descriptions" class="level3" data-number="6.19.2">
<h3 data-number="6.19.2" class="anchored" data-anchor-id="writing-pr-descriptions"><span class="header-section-number">6.19.2</span> Writing PR Descriptions</h3>
<p>When you submit a pull request, include a detailed PR title and description. A comprehensive description helps your reviewer and provides valuable historical context.</p>
<p><strong>PR Title</strong>: The title should be a short summary (ideally under 72 characters) of what is being done. It should be informative enough that future developers can understand what the PR did without reading the full description.</p>
<p>Poor titles that lack context:</p>
<ul>
<li>â€œFix bugâ€</li>
<li>â€œAdd patchâ€</li>
<li>â€œMoving code from A to Bâ€</li>
</ul>
<p>Better titles that summarize the actual change:</p>
<ul>
<li>â€œFix missing value handling in data processing functionâ€</li>
<li>â€œAdd support for custom date formats in import functionsâ€</li>
</ul>
<p><strong>PR Description Body</strong>: The description should provide context that helps the reviewer understand your PR. Consider including:</p>
<ul>
<li>A brief description of the problem being solved</li>
<li>Links to related issues (e.g., â€œCloses #123â€ or â€œRelated to #456â€)</li>
<li>A before/after example showing changed behavior</li>
<li>Possible shortcomings of the approach being used</li>
<li>For complex PRs, a suggested reading order for the reviewer</li>
<li>The <code>Files</code> tab of a Pull Request page on GitHub allows you to annotate your pull request with inline comments. These comments are not part of the source files; they only exist in GitHubâ€™s metadata. Use these comments to explain <em>changes</em> whose reasoning might not be self-apparent to a reviewer.</li>
</ul>
</section>
<section id="add-tests" class="level3" data-number="6.19.3">
<h3 data-number="6.19.3" class="anchored" data-anchor-id="add-tests"><span class="header-section-number">6.19.3</span> Add Tests</h3>
<p>Focused PRs should include related test code. A PR that adds or changes logic should be accompanied by new or updated tests for the new behavior. Pure refactoring PRs should also be covered by testsâ€”if tests donâ€™t exist for code youâ€™re refactoring, add them in a separate PR first to validate that behavior is unchanged.</p>
</section>
<section id="separate-out-refactorings" class="level3" data-number="6.19.4">
<h3 data-number="6.19.4" class="anchored" data-anchor-id="separate-out-refactorings"><span class="header-section-number">6.19.4</span> Separate Out Refactorings</h3>
<p>Itâ€™s usually best to do refactorings in a separate PR from feature changes or bug fixes. For example, moving and renaming a function should be in a different PR from fixing a bug in that function. This makes it much easier for reviewers to understand the changes introduced by each PR.</p>
<p>Small cleanups (like fixing a local variable name) can be included in a feature change or bug fix PR, but large refactorings should be separate.</p>
</section>
</section>
<section id="reviewing-pull-requests" class="level2" data-number="6.20">
<h2 data-number="6.20" class="anchored" data-anchor-id="reviewing-pull-requests"><span class="header-section-number">6.20</span> Reviewing Pull Requests</h2>
<section id="purpose-of-code-review" class="level3" data-number="6.20.1">
<h3 data-number="6.20.1" class="anchored" data-anchor-id="purpose-of-code-review"><span class="header-section-number">6.20.1</span> Purpose of Code Review</h3>
<p>The primary purpose of code review is to ensure that the overall code health of our projects improves over time. Reviewers should balance the need to make forward progress with the importance of maintaining code quality.</p>
<p><strong>Key principle</strong>: Reviewers should favor approving a PR once it is in a state where it definitely improves the overall code health of the system, even if the PR isnâ€™t perfect. There is no such thing as â€œperfectâ€ codeâ€”there is only better code. Rather than seeking perfection, seek continuous improvement.</p>
</section>
<section id="writing-review-comments" class="level3" data-number="6.20.2">
<h3 data-number="6.20.2" class="anchored" data-anchor-id="writing-review-comments"><span class="header-section-number">6.20.2</span> Writing Review Comments</h3>
<p>When reviewing code, maintain courtesy and respect while being clear and helpful:</p>
<ul>
<li>Comment on the <strong>code</strong>, not the author</li>
<li>Explain <strong>why</strong> youâ€™re making suggestions (reference best practices, design patterns, or how the suggestion improves code health)</li>
<li>Balance pointing out problems with providing guidance (help authors learn while being constructive)</li>
<li>Highlight positive aspects tooâ€”if you see good practices, comment on those to reinforce them</li>
</ul>
<p><strong>Poor comment</strong>: â€œWhy did you use this approach when thereâ€™s obviously a better way?â€</p>
<p><strong>Better comment</strong>: â€œThis approach adds complexity without clear benefits. Consider using [alternative approach] instead, which would simplify the logic and improve readability.â€</p>
</section>
<section id="mentoring-through-review" class="level3" data-number="6.20.3">
<h3 data-number="6.20.3" class="anchored" data-anchor-id="mentoring-through-review"><span class="header-section-number">6.20.3</span> Mentoring Through Review</h3>
<p>Code review is an excellent opportunity for mentoring. As a reviewer:</p>
<ul>
<li>Leave comments that help authors learn something new</li>
<li>Link to relevant sections of style guides or best practices documentation</li>
<li>Consider pair programming for complex reviewsâ€”live review sessions can be very effective for teaching</li>
</ul>
</section>
<section id="giving-constructive-feedback" class="level3" data-number="6.20.4">
<h3 data-number="6.20.4" class="anchored" data-anchor-id="giving-constructive-feedback"><span class="header-section-number">6.20.4</span> Giving Constructive Feedback</h3>
<p>In general, it is the authorâ€™s responsibility to fix a PR, not the reviewerâ€™s. Strike a balance between pointing out problems and providing direct guidance. Sometimes pointing out issues and letting the author decide on a solution helps them learn and may result in a better solution since they are closer to the code.</p>
<p>For very small tweaks (typos, comment additions), use GitHubâ€™s suggestion feature to allow authors to quickly accept changes directly in the UI.</p>
</section>
</section>
<section id="creating-a-pull-request-template" class="level2" data-number="6.21">
<h2 data-number="6.21" class="anchored" data-anchor-id="creating-a-pull-request-template"><span class="header-section-number">6.21</span> Creating a Pull Request Template</h2>
<p>GitHub allows you to create a pull request template in a repository to standardize the information in pull requests. When you add a template, everyone will automatically see its contents in the pull request body.</p>
<p>Follow these steps to add a pull request template:</p>
<ol type="1">
<li>On GitHub, navigate to the main page of the repository.</li>
<li>Above the file list, click <code>Create new file</code>.</li>
<li>Name the file <code>pull_request_template.md</code>. GitHub will not recognize this as the template if it is named anything else. The file must be on the default branch.
<ul>
<li>To store the file in a hidden directory, name it <code>.github/pull_request_template.md</code>.</li>
</ul></li>
<li>In the body of the new file, add your pull request template.</li>
</ol>
<p>Here is an example pull request template:</p>
<pre class="text"><code># Description

## Summary of change

Please include a summary of the change, including any new functions added and example usage.

## Related Issues

Closes #(issue number)
Related to #(issue number)

## Testing

Describe how this change has been tested.

## Checklist

- [ ] Tests added/updated
- [ ] Documentation updated
- [ ] Code follows project style guidelines

## Who should review the pull request?

@username
</code></pre>
</section>
<section id="sec-r-resources" class="level2" data-number="6.22">
<h2 data-number="6.22" class="anchored" data-anchor-id="sec-r-resources"><span class="header-section-number">6.22</span> Additional Resources</h2>
<section id="r-package-development" class="level3" data-number="6.22.1">
<h3 data-number="6.22.1" class="anchored" data-anchor-id="r-package-development"><span class="header-section-number">6.22.1</span> R Package Development</h3>
<ul>
<li><a href="https://r-pkgs.org/">R Packages book</a> by Hadley Wickham and Jenny Bryan - comprehensive guide to R package development</li>
<li><a href="https://design.tidyverse.org/">Tidyverse design guide</a> - principles for designing R packages and APIs that are intuitive, composable, and consistent with tidyverse philosophy</li>
<li><a href="https://usethis.r-lib.org/">usethis documentation</a> - workflow automation for R projects</li>
<li><a href="https://devtools.r-lib.org/">devtools documentation</a> - essential development tools</li>
<li><a href="https://pkgdown.r-lib.org/">pkgdown documentation</a> - create package websites</li>
<li><a href="https://testthat.r-lib.org/">testthat documentation</a> - unit testing framework</li>
</ul>
</section>
<section id="general-r-programming" class="level3" data-number="6.22.2">
<h3 data-number="6.22.2" class="anchored" data-anchor-id="general-r-programming"><span class="header-section-number">6.22.2</span> General R Programming</h3>
<ul>
<li><a href="https://r4ds.hadley.nz/">R for Data Science</a> by Hadley Wickham, Mine Ã‡etinkaya-Rundel, and Garrett Grolemund - learn data science with the tidyverse</li>
<li><a href="https://adv-r.hadley.nz/">Advanced R</a> by Hadley Wickham - deep dive into R programming and internals</li>
</ul>
</section>
<section id="shiny-development" class="level3" data-number="6.22.3">
<h3 data-number="6.22.3" class="anchored" data-anchor-id="shiny-development"><span class="header-section-number">6.22.3</span> Shiny Development</h3>
<ul>
<li><a href="https://mastering-shiny.org/">Mastering Shiny</a> by Hadley Wickham - comprehensive guide to building web applications with Shiny</li>
<li><a href="https://engineering-shiny.org/">Engineering Production-Grade Shiny Apps</a> by Colin Fay, SÃ©bastien Rochette, Vincent Guyader, and Cervan Girard - best practices for production Shiny applications</li>
</ul>
</section>
<section id="git-and-version-control" class="level3" data-number="6.22.4">
<h3 data-number="6.22.4" class="anchored" data-anchor-id="git-and-version-control"><span class="header-section-number">6.22.4</span> Git and Version Control</h3>
<ul>
<li><a href="https://happygitwithr.com/">Happy Git and GitHub for the useR</a> by Jenny Bryan - essential guide to using Git and GitHub with R</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04-code-repositories.html" class="pagination-link" aria-label="Code repositories">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Code repositories</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06-coding-style.html" class="pagination-link" aria-label="R Code Style">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">R Code Style</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/UCD-SERG/lab-manual/edit/main/05-coding-practices.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/UCD-SERG/lab-manual/blob/main/05-coding-practices.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/UCD-SERG/lab-manual/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>